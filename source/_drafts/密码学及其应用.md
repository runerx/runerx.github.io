---
title: 密码学及其应用
categories: 密码学
tags: 
- 比特币
- 密码学
---

<!-- 密码学是一门旨在保护协议免受攻击者破坏的科学。 -->

## 1. 引言

### 1.1 密码学使协议安全

密码学的目标：密码学是一门旨在保护协议免受攻击者破坏的科学。那么，协议是什么呢？简单来说，协议是一个人（或者多个人）为了完成某件事情而必须遵守的一系列步骤。

在古代，当统治者和将军们互相背叛并各自策划秘密行动时，他们面临的最大问题就是如何与他们信任的人分享机密信息。在此背景下，密码学的相关概念和技术应运而生。



### 1.2 对称加密概述

> 密码学算法通常也被称为密码学原语。

对称加密（Symmetric Encryption）是密码学的重要概念之一。

我们以高级加密标准（Advanced Encryption Standard，AES）加密算法为例。AES算法是一个由美国国家标准与技术研究院（National Institute of Standards andTechnology，NIST）组织的国际竞赛的产物

> NIST是一个美国的标准和指南制定机构，其提出的标准主要供美国政府相关职能部门、其他公共和私人组织使用。NIST对许多像AES算法这样应用广泛的密码原语进行了标准化

AES加密算法竞赛持续了数年之久，其间有许多来自世界各地的密码分析者参与尝试攻击各种各样的候选算法。历经数年的公开分析，人们对候选算法产生了足够的信心，最终将一个最具竞争力的算法提名为AES算法。如今，人们普遍认为AES算法是一个可靠、应用广泛的加密算法。例如，我们每天浏览网页就会用这个算法



### 1.3 Kerckhoff原则：只有密钥保密

以公开方式构造密码算法标准的思路与Kerckhoff原则有关，该原则可以理解为：依靠保密算法来实现安全是不明智的，因为敌手很容易知道我们所使用的密码算法。因此，我们会选择公开密码算法。

如果Alice和Bob的敌手知道他们加密信息的算法，那么他们的加密算法还怎么保证安全呢？答案是密钥。协议的安全依赖密钥，而与算法本身是否保密无关。

### 1.4 非对称加密概述

对称加密的秘钥分发问题在相当长的一段时间内该问题都未被解决，直到20世纪70年代末密码学家发现了另一类称为非对称密码（Asymmetric Cryptography）或公钥密码（Public Key Cryptography）的算法，密钥分发问题才得以解决。

**秘钥交换（Secret Key Exchange）**

DH密钥交换算法是密码学家提出的第一个公钥密码算法，该算法以其提出者（Diffie和Hellman）的名字的首字母命名。DH密钥交换算法的主要目的是为通信双方生成一个共享的秘密。这个双方共享的秘密可以用于不同的目的，例如作为对称加密原语的密钥。

**非对称加密**

在DH密钥交换算法提出后不久，密码学家Ron Rivest、Adi Shamir和Leonard Adleman又提出了一个新的密码算法，该算法也以他们的名字命名，称为RSA算法。RSA算法包含两类不同的密码学原语：公钥加密（或非对称加密）算法和（数字）签名算法。

**数字签名**



## 哈希函数

哈希函数（Hash Function）

它可以给任何数据生成一个全局唯一的标识符。哈希函数在密码学中随处可见！非正式地说，哈希函数以任意值为输入，并输出一个唯一的字节串。给定相同的输入，哈希函数总是产生相同的字节串。

哈希函数的输出通常被称为摘要（Digest）或哈希值（Hash）。

当我们想要尝试计算哈希值时，可以使用流行的OpenSSL库。该库提供了一个多用途的命令行接口（Command Line Interface，CLI），macOS之类的许多系统中自带该命令行工具。例如，打开终端并输入如下命令：
$ openssl dgst -sha256 downloaded_file
f63e68ac0bf052ae923c03f5b12aedc6cca49874c1c9b0ccf3f39b662d1f487b

顺便说一下，上面的字符串f63e...采用的是十六进制（Base16编码，使用从0到9的数字和从a到f的字母来表示任意数据）表示形式。我们本可以用包含0和1的二进制编码方法表示哈希函数的输出，但这样会占用更多空间。十六进制编码允许我们将8比特（1字节）数编码成2个字符。这种编码方式具有可读性强、占用的空间少的优点。我们还可以使用其他的编码方法将二进制数据编码成可读字符，但十六进制编码和Base64编码是使用最多的两种编码方式。在Base系列编码中，基越大，编码二进制数据需要的字符数就越多。当然，如果用的基过大，我们可能就无法用已有的可读字符编码二进制数据。

哈希函数的第一个属性是抗第一原像性（Pre-image Resistance）。这一属性表示无法根据哈希函数的输出恢复其对应的输入。

哈希函数的第二个属性是抗第二原像性（Second Pre-image Resistance）。前面提到的文件完整性验证示例就用到这个安全性质。该性质说明如下：给定一个输入和它的哈希值，无法找到一个不同于该输入的新输入，使得这两个输入产生一样的哈希值。

哈希函数的第三个属性是抗碰撞性（Collision Resistance）。这个性质保证不能够产生哈希值相同的两个不同的输入（见图2.5）。在图2.5中，攻击者可以改变两个输入，这与之前只准改变其中一个输入的要求不同。



### 生日界限



### 哈希函数的实际应用

1. 承诺

   想象一下，如果我们知道了市场上的一只股票会增值，并在未来一个月达到50美元/股，虽然我们不能在当时告诉朋友（也许是出于某种法律原因），却还是希望可以在事后告诉朋友我们早知道这件事了。那么，我们就可以对一句话生成一个承诺，如计算“股票X下个月将达到50美元/股”这句话的哈希值，并把输出结果交给朋友。一个月后当我们公开这句话时，朋友将能够通过计算这句话的哈希值，然后与我们一个月前公开的哈希值进行比较，从而判断我们所说的真伪。这就是承诺方案。密码学中的承诺需要具备以下两种性质。
   ・隐蔽性（Hiding）：承诺必须隐蔽基础值。
   ・绑定性（Binding）：承诺必须只隐藏一个值。换句话说，如果给定一个值x
   的承诺，那么之后无法公开另一个可以通过承诺验证的值y
   。

2. 子资源完整性

   网页导入外部JavaScript文件的时候需要用哈希函数来验证子资源的完整性。例如，很多网站使用内容分发网络（Content Delivery Network，CDN）将JavaScript库或网络框架相关的文件导入网页中。这种CDN被部署在重要位置以便迅速将这些文件传递给访问者。然而，如果CDN不守规矩，故意为访问者提供恶意的JavaScript文件，则可能造成严重的问题。为了解决这个问题，网页可以使用子资源完整性（Subresource Integrity）的功能，允许在导入标签中包含一个摘要：
   <script src=”https://code.jquery.com/jquery-2.1.4.min.js”
      integrity=”sha256-8WqyJLuWKRBVhxXIL1jBDD7SDxU936oZkCnx
   QbWwJVw=”></script>
   一旦检索到JavaScript文件，浏览器就会计算它的哈希值（使用SHA-256算法），并核实它是否与页面中硬编码的摘要一致。如果一致，则可以通过完整性验证，该JavaScript文件就会被执行。

3. 比特流

   世界各地的用户使用比特流（BitTorrent）协议，在彼此之间直接分享文件（这种方式称为Peer-to-Peer）。为了分发一个文件，首先将文件切割成块，每个块都被单独计算哈希值。之后这些哈希值作为共享的信任源，代表要下载的文件。
   比特流协议有几种机制，使得一个Peer可以从不同的Peer中获得一个文件不同的块。最后，整个文件的完整性将通过以下方式得到验证：在将文件从块中重新组合之前，对每个块进行哈希运算，并将输出结果与各自已知的摘要进行比对。例如，下面的例子代表Ubuntu操作系统的 19.04版本。它是通过对文件的元数据以及所有块的摘要进行哈希运算得到的一个摘要（用十六进制表示）：
   magnet:?xt=urn:btih:b7b0fbab74a85d4ac170662c645982a862826455

4. 洋葱路由

   洋葱路由（Tor）浏览器出现的目的是使个人可以匿名浏览互联网。它的另一个特点是，人们可以创建隐藏的网页，即网站的物理位置难以追踪。我们可以通过一个使用网页公钥的协议来保证与这些网页的安全连接。（第9章讨论会话加密时将列举更多关于该协议的工作原理）例如，毒品交易网站在被FBI查封之前，可以在Tor浏览器中通过silkroad6ownowfk.onion进行访问。这个Base32字符串实际上代表了丝绸之路网站公钥的哈希值。因此，可以通过洋葱路由地址来验证隐藏网页的公钥，并确定当前访问的网页是正确的（而不是一个冒名顶替者）。如果不能理解这一点也不必担心，我们将在第9章中再次提到这个问题。



### SHA-2哈希函

2是广泛应用的哈希函数。SHA-2算法由NSA发明并在2001年由NIST进行了标准化。SHA-2算法在设计上借鉴了由NIST标准化过的SHA-1算法。SHA-2算法族共有 4 个不同的版本，它们分别产生224、256、384和512比特的输出。这些算法在命名上包含其输出的比特长但省略了算法的版本，它们的名字分别为SHA-224、SHA-256、SHA-384 和SHA-512。此外，SHA-512/224和SHA-512/256算法是通过截断SHA-512算法的输出产生的两个变种算法，它们分别提供224比特和256比特的输出。





## 消息认证码

的哈希函数和密钥结合起来，我们将得到一个新的保护数据完整性的密码学原语——消息认证码（Message Authentication Code，MAC）。
